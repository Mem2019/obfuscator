# This file is automatically generated from cmake.toml - DO NOT EDIT
# See https://github.com/build-cpp/cmkr for more information

# Create a configure-time dependency on cmake.toml to improve IDE support
if(CMKR_ROOT_PROJECT)
	configure_file(cmake.toml cmake.toml COPYONLY)
endif()

# Target: obfuscator-lib
set(obfuscator-lib_SOURCES
	"lib/analysis/analysis.cpp"
	"lib/analysis/bb_decomp/bb_decomp.cpp"
	"lib/analysis/bb_decomp/jumptables.cpp"
	"lib/analysis/passes/misc/bb_insn_passes.cpp"
	"lib/config_parser/config_parser.cpp"
	"lib/easm/assembler/assembler.cpp"
	"lib/easm/disassembler/disassembler.cpp"
	"lib/func_parser/map/map.cpp"
	"lib/func_parser/parser.cpp"
	"lib/func_parser/pdb/detail/reader_v7.cpp"
	"lib/func_parser/pdb/pdb.cpp"
	"lib/mathop/operations/impl/add.cpp"
	"lib/mathop/operations/impl/dec.cpp"
	"lib/mathop/operations/impl/inc.cpp"
	"lib/mathop/operations/impl/neg.cpp"
	"lib/mathop/operations/impl/not.cpp"
	"lib/mathop/operations/impl/sub.cpp"
	"lib/mathop/operations/impl/xor.cpp"
	"lib/obfuscator/obfuscator.cpp"
	"lib/obfuscator/transforms/startup.cpp"
	"lib/pe/pe.cpp"
	"lib/pe/rebuilder/detail/copy_sections.cpp"
	"lib/pe/rebuilder/detail/init_header.cpp"
	"lib/pe/rebuilder/detail/update_checksum.cpp"
	"lib/pe/rebuilder/detail/update_relocations.cpp"
	cmake.toml
)

add_library(obfuscator-lib)

target_sources(obfuscator-lib PRIVATE ${obfuscator-lib_SOURCES})
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${obfuscator-lib_SOURCES})

add_library(obfuscator::lib ALIAS obfuscator-lib)
target_compile_definitions(obfuscator-lib PUBLIC
	NOMINMAX
)

target_compile_features(obfuscator-lib PUBLIC
	cxx_std_23
)

if(UNIX) # unix
	target_compile_options(obfuscator-lib PUBLIC
		-stdlib=libc++
	)
endif()

if(MSVC) # msvc
	target_compile_options(obfuscator-lib PUBLIC
		"/wd4661"
		"/MP"
	)
endif()

if(UNIX) # unix
	target_link_options(obfuscator-lib PUBLIC
		-fuse-ld=lld
		"-Wl,-L/usr/local/lib/"
	)
endif()

target_include_directories(obfuscator-lib PUBLIC
	"lib/"
)

target_link_libraries(obfuscator-lib PUBLIC
	zasm
	linux-pe
	magic_enum
)

# Target: obfuscator
set(obfuscator_SOURCES
	"bin/entry.cpp"
	cmake.toml
)

add_executable(obfuscator)

target_sources(obfuscator PRIVATE ${obfuscator_SOURCES})
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${obfuscator_SOURCES})

target_compile_definitions(obfuscator PRIVATE
	NOMINMAX
)

target_compile_features(obfuscator PRIVATE
	cxx_std_23
)

if(UNIX) # unix
	target_compile_options(obfuscator PRIVATE
		-stdlib=libc++
	)
endif()

if(MSVC) # msvc
	target_compile_options(obfuscator PRIVATE
		"/wd4661"
		"/MP"
	)
endif()

if(UNIX) # unix
	target_link_options(obfuscator PRIVATE
		-fuse-ld=lld
		"-Wl,-L/usr/local/lib/"
	)
endif()

target_include_directories(obfuscator PRIVATE
	"bin/"
)

target_link_libraries(obfuscator PRIVATE
	obfuscator::lib
)

get_directory_property(CMKR_VS_STARTUP_PROJECT DIRECTORY ${PROJECT_SOURCE_DIR} DEFINITION VS_STARTUP_PROJECT)
if(NOT CMKR_VS_STARTUP_PROJECT)
	set_property(DIRECTORY ${PROJECT_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT obfuscator)
endif()

# Target: obfuscator-tests
if(OBFUSCATOR_BUILD_TESTS) # build-tests
	set(obfuscator-tests_SOURCES
		"tests/analysis/bb_decomp/bb_decomp.llvm.cpp"
		"tests/analysis/bb_decomp/bb_decomp.msvc.cpp"
		"tests/func_parser/map/map.ida.cpp"
		"tests/func_parser/map/map.llvm.cpp"
		"tests/func_parser/map/map.msvc.cpp"
		"tests/func_parser/pdb/pdb.llvm.cpp"
		"tests/func_parser/pdb/pdb.msvc.cpp"
		cmake.toml
	)

	add_executable(obfuscator-tests)

	target_sources(obfuscator-tests PRIVATE ${obfuscator-tests_SOURCES})
	source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${obfuscator-tests_SOURCES})

	target_compile_definitions(obfuscator-tests PRIVATE
		NOMINMAX
	)

	target_compile_features(obfuscator-tests PRIVATE
		cxx_std_23
	)

	if(UNIX) # unix
		target_compile_options(obfuscator-tests PRIVATE
			-stdlib=libc++
		)
	endif()

	if(MSVC) # msvc
		target_compile_options(obfuscator-tests PRIVATE
			"/wd4661"
			"/MP"
		)
	endif()

	if(UNIX) # unix
		target_link_options(obfuscator-tests PRIVATE
			-fuse-ld=lld
			"-Wl,-L/usr/local/lib/"
		)
	endif()

	target_include_directories(obfuscator-tests PRIVATE
		"tests/"
	)

	target_link_libraries(obfuscator-tests PRIVATE
		obfuscator::lib
		GTest::gtest_main
	)

	set_target_properties(obfuscator-tests PROPERTIES
		PROJECT_LABEL
			tests
	)

	get_directory_property(CMKR_VS_STARTUP_PROJECT DIRECTORY ${PROJECT_SOURCE_DIR} DEFINITION VS_STARTUP_PROJECT)
	if(NOT CMKR_VS_STARTUP_PROJECT)
		set_property(DIRECTORY ${PROJECT_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT obfuscator-tests)
	endif()

	set(CMKR_TARGET obfuscator-tests)
	FetchContent_MakeAvailable(resources)
	target_compile_definitions(obfuscator-tests PRIVATE OBFUSCATOR_RESOURCES_PATH="${resources_SOURCE_DIR}")

endif()
enable_testing()

if(OBFUSCATOR_BUILD_TESTS) # build-tests
	add_test(
		NAME
			tests
		WORKING_DIRECTORY
			"${CMAKE_CURRENT_LIST_DIR}/"
		COMMAND
			"$<TARGET_FILE:obfuscator-tests>"
	)

endif()
